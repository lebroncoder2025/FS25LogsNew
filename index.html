<!doctype html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FS25 Logs Report</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        h2 { margin-top: 40px; }
        .loading { color: gray; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>FS25 Logs Report</h1>
    <p>Generated: 2025-10-14 14:46:54</p>
    
    <h2>Event Counts</h2>
    <div id="event-counts" class="loading">Loading...</div>
    
    <h2>All Events</h2>
    <table id="events-table">
        <thead><tr><th>Timestamp</th><th>Line Type</th><th>Event Type</th><th>Details</th><th>Raw Line</th></tr></thead>
        <tbody><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
    </table>
    
    <script>
    async function loadReport() {
        try {
            const response = await fetch('data_index.json');
            if (!response.ok) {
                throw new Error('Failed to load data_index.json: ' + response.status);
            }
            const index = await response.json();
            
            // Render event counts
            const countsDiv = document.getElementById('event-counts');
            countsDiv.innerHTML = '';
            Object.entries(index.raw_event_counts).forEach(([key, value]) => {
                countsDiv.innerHTML += `<p><strong>${key}:</strong> ${value}</p>`;
            });
            
            // Load parts
            const parts = index.tables_index.parts || [];
            let allRows = [];
            for (const part of parts) {
                const partResponse = await fetch(part.file);
                if (!partResponse.ok) {
                    console.error('Failed to load part: ' + part.file);
                    continue;
                }
                const rows = await partResponse.json();
                allRows = allRows.concat(rows);
            }
            
            // Group rows by table (tutaj tylko 'events')
            const tables = {};
            allRows.forEach(item => {
                const tname = item.table;
                if (!tables[tname]) tables[tname] = [];
                tables[tname].push(item.row);
            });
            
            // Render tabelÄ™ events
            const tbody = document.getElementById('events-table').querySelector('tbody');
            tbody.innerHTML = '';
            const rows = tables['events'] || [];
            if (rows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No data available</td></tr>';
            } else {
                rows.forEach(row => {
                    const timestamp = row.Timestamp || 'N/A';
                    const lineType = row.LineType || 'N/A';
                    const eventType = row.EventType || 'N/A';
                    const details = JSON.stringify(row.Details || {}, null, 2).replace(/\n/g, '<br>');
                    const rawLine = row.RawLine ? row.RawLine.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') : 'N/A';
                    tbody.innerHTML += `<tr><td>${timestamp}</td><td>${lineType}</td><td>${eventType}</td><td><pre>${details}</pre></td><td><pre>${rawLine}</pre></td></tr>`;
                });
            }
        } catch (error) {
            console.error('Error loading report:', error);
            document.body.innerHTML += '<p style="color: red;">Error loading report. Check console for details.</p>';
        }
    }
    loadReport();
    </script>
</body>
</html>